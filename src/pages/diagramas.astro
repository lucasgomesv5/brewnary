---
import MainLayout from '../layouts/MainLayout.astro';

const categories = [
  {
    id: 'system-design',
    title: 'System Design & Arquitetura',
    color: '#3b82f6',
    diagrams: [
      {
        href: '/diagramas/system-design/url-shortener',
        title: 'URL Shortener',
        desc: 'API Gateway, Base62/Snowflake, Redis cache, Bloom Filter, Kafka analytics e ClickHouse.',
        steps: 10,
        color: '#3b82f6',
      },
      {
        href: '/diagramas/system-design/chat-system',
        title: 'Chat System (WhatsApp-scale)',
        desc: 'WebSocket, Cassandra, Kafka fan-out, delivery guarantees, E2E encryption e media upload.',
        steps: 11,
        color: '#22c55e',
      },
      {
        href: '/diagramas/system-design/microservices',
        title: 'Microservices Communication',
        desc: 'REST vs gRPC, Saga Pattern, Circuit Breaker, Service Mesh e CQRS.',
        steps: 10,
        color: '#a855f7',
      },
    ],
  },
  {
    id: 'infrastructure',
    title: 'Infraestrutura & DevOps',
    color: '#06b6d4',
    diagrams: [
      {
        href: '/diagramas/infrastructure/cicd-pipeline',
        title: 'CI/CD Pipeline',
        desc: 'Build, testes, SAST/DAST, deploy strategies (Canary/Blue-Green) e rollback automático.',
        steps: 10,
        color: '#06b6d4',
      },
      {
        href: '/diagramas/infrastructure/kubernetes',
        title: 'Kubernetes Architecture',
        desc: 'Control Plane, etcd (Raft), Scheduler, kubelet, kube-proxy, pod lifecycle e Services.',
        steps: 10,
        color: '#3b82f6',
      },
      {
        href: '/diagramas/infrastructure/observability',
        title: 'Observability Stack',
        desc: 'Prometheus, Fluentd/Loki, OpenTelemetry/Jaeger, Golden Signals, SLOs e Alertmanager.',
        steps: 9,
        color: '#f59e0b',
      },
    ],
  },
  {
    id: 'databases',
    title: 'Bancos de Dados & Storage',
    color: '#8B5CF6',
    diagrams: [
      {
        href: '/diagramas/databases/btree-vs-lsm',
        title: 'B-Tree vs LSM-Tree',
        desc: 'Storage engines, page layout, compaction, Bloom filters e trade-offs read vs write.',
        steps: 10,
        color: '#8B5CF6',
      },
      {
        href: '/diagramas/databases/raft-consensus',
        title: 'Raft Consensus',
        desc: 'Election, RequestVote, AppendEntries, quorum commit e safety guarantees.',
        steps: 10,
        color: '#ef4444',
      },
      {
        href: '/diagramas/databases/cap-theorem',
        title: 'CAP Theorem + ACID vs BASE',
        desc: 'Triângulo CAP, CP vs AP, ACID vs BASE, espectro de consistência e framework de decisão.',
        steps: 9,
        color: '#22c55e',
      },
    ],
  },
  {
    id: 'frontend',
    title: 'Frontend & Web',
    color: '#ec4899',
    diagrams: [
      {
        href: '/diagramas/frontend/browser-rendering',
        title: 'Browser Rendering Pipeline',
        desc: 'Critical Rendering Path: HTML parsing, DOM/CSSOM, Layout, Paint, Composite e otimizações.',
        steps: 10,
        color: '#ec4899',
      },
      {
        href: '/diagramas/frontend/react-fiber',
        title: 'React Fiber & Reconciliation',
        desc: 'Fiber nodes, double buffering, O(n) diffing, render/commit phases, lanes, hooks internals e concurrent features.',
        steps: 11,
        color: '#61dafb',
      },
      {
        href: '/diagramas/frontend/web-performance',
        title: 'Web Performance & Core Web Vitals',
        desc: 'LCP, INP, CLS, bundle optimization, caching, rendering patterns (CSR/SSR/SSG/ISR) e monitoring.',
        steps: 10,
        color: '#22c55e',
      },
    ],
  },
  {
    id: 'networking',
    title: 'Networking & Segurança',
    color: '#f97316',
    diagrams: [
      {
        href: '/diagramas/networking/oauth-flow',
        title: 'OAuth 2.0 + OIDC',
        desc: 'Authorization Code Flow, PKCE, JWT structure/claims, refresh token rotation e OpenID Connect.',
        steps: 10,
        color: '#f97316',
      },
      {
        href: '/diagramas/networking/dns-cdn',
        title: 'DNS & CDN Deep Dive',
        desc: 'Cache chain, resolução iterativa, Root/TLD/Auth NS, DNSSEC, CDN PoPs e invalidação.',
        steps: 10,
        color: '#a855f7',
      },
      {
        href: '/diagramas/networking/tcp-ip-stack',
        title: 'TCP/IP Stack & Congestion',
        desc: '4 camadas, 3-way handshake, sliding window, Slow Start, Cubic/BBR e QUIC.',
        steps: 10,
        color: '#06b6d4',
      },
    ],
  },
];
---

<MainLayout
  title="Diagramas"
  description="15 diagramas interativos de system design, infraestrutura, bancos de dados, frontend e networking."
>
  <div class="mx-auto max-w-5xl px-4 py-12 sm:px-6">
    <div class="mb-10">
      <h1 class="mb-3 text-3xl font-bold tracking-tight sm:text-4xl">Diagramas</h1>
      <p class="max-w-xl text-sm text-[var(--color-text-muted)]">
        15 diagramas interativos com build-up passo a passo. Cada diagrama pode ser explorado incrementalmente ou visualizado completo.
      </p>
    </div>

    <!-- Quick navigation -->
    <nav class="mb-10 flex flex-wrap gap-2">
      {categories.map((cat) => (
        <a
          href={`#${cat.id}`}
          class="rounded-lg border border-[var(--color-border)] px-3 py-1.5 text-xs font-medium transition-colors hover:border-[var(--color-text-muted)]"
          style={`border-left: 3px solid ${cat.color}`}
        >
          {cat.title}
        </a>
      ))}
    </nav>

    <!-- Categories -->
    {categories.map((cat) => (
      <section id={cat.id} class="mb-12">
        <div class="mb-4 flex items-center gap-3">
          <div class="h-0.5 w-6" style={`background-color: ${cat.color}`} />
          <h2 class="text-lg font-bold">{cat.title}</h2>
          <span class="rounded-full px-2 py-0.5 text-[10px] font-medium" style={`background-color: ${cat.color}20; color: ${cat.color}`}>
            {cat.diagrams.length} diagramas
          </span>
        </div>

        <div class="grid grid-cols-1 gap-4 md:grid-cols-2">
          {cat.diagrams.map((item) => (
            <a
              href={item.href}
              class="group block overflow-hidden rounded-lg border border-[var(--color-border)] bg-[var(--color-bg-alt)] transition-colors hover:border-[var(--color-text-muted)]"
            >
              <div class="h-0.5" style={`background-color: ${item.color}`} />
              <div class="p-5">
                <div class="mb-1.5 flex items-center gap-2">
                  <h3 class="text-sm font-bold">{item.title}</h3>
                  <span class="rounded-full px-1.5 py-0.5 text-[9px] font-mono font-medium" style={`background-color: ${item.color}15; color: ${item.color}`}>
                    {item.steps} steps
                  </span>
                </div>
                <p class="text-xs leading-relaxed text-[var(--color-text-muted)]">{item.desc}</p>
                <span class="mt-3 inline-flex items-center gap-1 text-xs text-[var(--color-text-muted)] transition-colors group-hover:text-[var(--color-text)]">
                  Explorar
                  <svg class="h-3 w-3" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M5 12h14" />
                    <path d="m12 5 7 7-7 7" />
                  </svg>
                </span>
              </div>
            </a>
          ))}
        </div>
      </section>
    ))}

    <div class="mt-4 rounded-xl border border-[var(--color-border)] bg-[var(--color-bg-alt)] p-6 text-center">
      <h2 class="mb-2 text-lg font-bold">Visualizadores de Algoritmos</h2>
      <p class="mx-auto mb-4 max-w-md text-sm text-[var(--color-text-muted)]">
        Os visualizadores interativos de algoritmos fazem parte da página de DSA, com 19 algoritmos animados passo a passo.
      </p>
      <a
        href="/dsa"
        class="inline-flex items-center gap-2 rounded-lg border border-[var(--color-border)] px-4 py-2 text-sm font-medium transition-colors hover:border-[var(--color-text-muted)]"
      >
        Ver Algoritmos & DSA
        <svg class="h-4 w-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M5 12h14" />
          <path d="m12 5 7 7-7 7" />
        </svg>
      </a>
    </div>

    <!-- References / Disclaimer -->
    <div class="mt-12 border-t border-[var(--color-border)] pt-8">
      <h2 class="mb-3 text-sm font-bold text-[var(--color-text-muted)]">Fontes & Referências</h2>
      <p class="mb-4 max-w-3xl text-xs leading-relaxed text-[var(--color-text-muted)]">
        Os diagramas foram elaborados como material de estudo e consolidação de conhecimento, sintetizando conteúdo de diversas fontes técnicas reconhecidas. Números como latências, throughput e tamanhos são valores de referência típicos e podem variar conforme ambiente, configuração e escala.
      </p>
      <div class="grid grid-cols-1 gap-x-8 gap-y-2 text-xs text-[var(--color-text-muted)] md:grid-cols-2">
        <div>
          <p class="mb-1 font-semibold">System Design & Arquitetura</p>
          <ul class="mb-3 list-inside list-disc space-y-0.5">
            <li><em>Designing Data-Intensive Applications</em> — Martin Kleppmann (O'Reilly)</li>
            <li><em>System Design Interview</em> — Alex Xu (Vol. 1 & 2)</li>
            <li><em>Building Microservices</em> — Sam Newman (O'Reilly)</li>
            <li>Documentação oficial: <a href="https://kafka.apache.org/documentation/" class="underline hover:text-[var(--color-text)]" target="_blank" rel="noopener">Apache Kafka</a>, <a href="https://redis.io/docs/" class="underline hover:text-[var(--color-text)]" target="_blank" rel="noopener">Redis</a></li>
          </ul>

          <p class="mb-1 font-semibold">Infraestrutura & DevOps</p>
          <ul class="mb-3 list-inside list-disc space-y-0.5">
            <li>Documentação oficial: <a href="https://kubernetes.io/docs/" class="underline hover:text-[var(--color-text)]" target="_blank" rel="noopener">Kubernetes</a>, <a href="https://prometheus.io/docs/" class="underline hover:text-[var(--color-text)]" target="_blank" rel="noopener">Prometheus</a>, <a href="https://opentelemetry.io/docs/" class="underline hover:text-[var(--color-text)]" target="_blank" rel="noopener">OpenTelemetry</a></li>
            <li><em>Site Reliability Engineering</em> — Google (O'Reilly)</li>
            <li><em>Continuous Delivery</em> — Jez Humble & David Farley</li>
          </ul>

          <p class="mb-1 font-semibold">Frontend & Web</p>
          <ul class="mb-3 list-inside list-disc space-y-0.5">
            <li><a href="https://web.dev/articles/rendering-performance" class="underline hover:text-[var(--color-text)]" target="_blank" rel="noopener">web.dev — Rendering Performance</a> (Google)</li>
            <li><a href="https://web.dev/explore/learn-core-web-vitals" class="underline hover:text-[var(--color-text)]" target="_blank" rel="noopener">web.dev — Core Web Vitals</a> (Google)</li>
            <li><a href="https://github.com/acdlite/react-fiber-architecture" class="underline hover:text-[var(--color-text)]" target="_blank" rel="noopener">React Fiber Architecture</a> — Andrew Clark</li>
            <li><a href="https://react.dev/reference/react" class="underline hover:text-[var(--color-text)]" target="_blank" rel="noopener">React Docs</a> — react.dev</li>
          </ul>
        </div>
        <div>
          <p class="mb-1 font-semibold">Bancos de Dados & Storage</p>
          <ul class="mb-3 list-inside list-disc space-y-0.5">
            <li><em>Designing Data-Intensive Applications</em> — Cap. 3 (Storage Engines), Cap. 9 (Consistency & Consensus)</li>
            <li><a href="https://raft.github.io/raft.pdf" class="underline hover:text-[var(--color-text)]" target="_blank" rel="noopener">In Search of an Understandable Consensus Algorithm</a> — Diego Ongaro & John Ousterhout (Raft paper)</li>
            <li><a href="https://www.cs.berkeley.edu/~brewer/cs262b-2004/PODC-keynote.pdf" class="underline hover:text-[var(--color-text)]" target="_blank" rel="noopener">Towards Robust Distributed Systems</a> — Eric Brewer (CAP Theorem)</li>
          </ul>

          <p class="mb-1 font-semibold">Networking & Segurança</p>
          <ul class="mb-3 list-inside list-disc space-y-0.5">
            <li>RFCs: <a href="https://datatracker.ietf.org/doc/html/rfc6749" class="underline hover:text-[var(--color-text)]" target="_blank" rel="noopener">RFC 6749</a> (OAuth 2.0), <a href="https://datatracker.ietf.org/doc/html/rfc7519" class="underline hover:text-[var(--color-text)]" target="_blank" rel="noopener">RFC 7519</a> (JWT), <a href="https://datatracker.ietf.org/doc/html/rfc9000" class="underline hover:text-[var(--color-text)]" target="_blank" rel="noopener">RFC 9000</a> (QUIC)</li>
            <li><em>Computer Networking: A Top-Down Approach</em> — Kurose & Ross</li>
            <li><em>High Performance Browser Networking</em> — Ilya Grigorik (<a href="https://hpbn.co/" class="underline hover:text-[var(--color-text)]" target="_blank" rel="noopener">hpbn.co</a>)</li>
            <li>Documentação: <a href="https://www.cloudflare.com/learning/" class="underline hover:text-[var(--color-text)]" target="_blank" rel="noopener">Cloudflare Learning Center</a></li>
          </ul>
        </div>
      </div>
      <p class="mt-4 text-[10px] italic text-[var(--color-text-muted)] opacity-60">
        Este material é de caráter educacional. Diagramas simplificam arquiteturas reais para facilitar o aprendizado. Consulte a documentação oficial de cada tecnologia para detalhes de implementação em produção.
      </p>
    </div>
  </div>
</MainLayout>
