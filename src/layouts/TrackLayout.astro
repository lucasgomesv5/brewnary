---
import BaseLayout from './BaseLayout.astro';
import TopNav from '../components/layout/TopNav.astro';
import TrackSidebar from '../components/layout/TrackSidebar.astro';
import Footer from '../components/layout/Footer.astro';
import LessonNav from '../components/ui/LessonNav.astro';
import Breadcrumbs from '../components/ui/Breadcrumbs.astro';
import TableOfContents from '../components/ui/TableOfContents.astro';
import ScrollProgress from '../components/react/ScrollProgress';
import { getTrackColor } from '../lib/tracks';

interface Props {
  title: string;
  description?: string;
  track: string;
  currentLesson?: string;
  headings?: Array<{ depth: number; slug: string; text: string }>;
  prevLesson?: { slug: string; title: string } | null;
  nextLesson?: { slug: string; title: string } | null;
}

const { title, description, track, currentLesson, headings = [], prevLesson, nextLesson } = Astro.props;
const trackColor = getTrackColor(track);
---

<BaseLayout title={title} description={description}>
  <ScrollProgress client:load trackColor={trackColor} />
  <TopNav activeTrack={track} />

  <div class="pt-14">
    <TrackSidebar track={track} currentLesson={currentLesson} />

    <!-- Main content area â€” takes full width, sidebar is fixed overlay on lg -->
    <div class="lg:ml-72 xl:mr-52">
      <div class="mx-auto max-w-4xl px-4 py-8 sm:px-6 lg:px-8">
        <Breadcrumbs track={track} lessonTitle={title} />

        <article class="prose mt-6">
          <h1 class="mb-6 text-2xl font-bold sm:text-3xl">{title}</h1>
          <slot />
        </article>

        <LessonNav prevLesson={prevLesson} nextLesson={nextLesson} track={track} />
      </div>

      {
        headings.length > 0 && (
          <aside class="scrollbar-thin fixed top-18 right-0 bottom-0 hidden w-52 overflow-y-auto pt-4 pr-6 pb-8 xl:block">
            <TableOfContents headings={headings} />
          </aside>
        )
      }

      <!-- Footer inside the content column so it doesn't go under sidebar -->
      <Footer />
    </div>
  </div>
</BaseLayout>
